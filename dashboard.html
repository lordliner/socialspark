<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SocialSpark</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #2c3e50;
            --background-color: #ffffff;
            --text-color: #333333;
            --border-color: #e1e1e1;
            --success-color: #27ae60;
            --error-color: #e74c3c;
        }

        .dark-theme {
            --background-color: #1a1a1a;
            --text-color: #ffffff;
            --border-color: #333333;
            --secondary-color: #34495e;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .theme-toggle {
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            background: var(--secondary-color);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-profile {
            display: flex;
            gap: 20px;
            margin: 30px 0;
            padding: 20px;
            background: var(--secondary-color);
            border-radius: 10px;
            color: white;
        }

        .profile-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: var(--secondary-color);
        }

        .profile-info {
            flex: 1;
        }

        .social-links {
            margin-top: 30px;
        }

        .social-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            margin-bottom: 10px;
            background: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .social-link:hover {
            transform: translateX(10px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .social-link.connected {
            border-color: var(--success-color);
        }

        .social-link i {
            font-size: 24px;
            width: 30px;
        }

        .social-link .status {
            margin-left: auto;
            color: var(--success-color);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--primary-color);
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .logout-btn {
            background: var(--error-color);
        }

        @media (max-width: 768px) {
            .user-profile {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .profile-info {
                text-align: center;
            }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .sidebar {
            background: var(--secondary-color);
            padding: 20px;
            border-radius: 10px;
            color: white;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-menu li {
            margin-bottom: 10px;
        }

        .sidebar-menu a {
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .sidebar-menu a:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu a.active {
            background: var(--primary-color);
        }

        .main-content {
            padding: 20px;
            background: var(--background-color);
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--secondary-color);
            padding: 20px;
            border-radius: 10px;
            color: white;
            text-align: center;
        }

        .stat-card h3 {
            margin: 0;
            font-size: 2em;
        }

        .post-form {
            margin-bottom: 30px;
        }

        .post-form textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            margin-bottom: 10px;
            background: var(--background-color);
            color: var(--text-color);
        }

        .post-actions {
            display: flex;
            gap: 10px;
        }

        .platform-select {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .platform-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
        }

        .platform-option:hover {
            background: rgba(74, 144, 226, 0.1);
        }

        .post-scheduling {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .schedule-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .schedule-details, .recurring-details {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }

        .recurring-options {
            display: grid;
            gap: 15px;
        }

        .day-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .post-preview {
            margin-top: 20px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            overflow: hidden;
        }

        .preview-tabs {
            display: flex;
            overflow-x: auto;
            background: var(--secondary-color);
        }

        .preview-tab {
            padding: 10px 20px;
            border: none;
            background: none;
            color: white;
            cursor: pointer;
        }

        .preview-tab.active {
            background: var(--primary-color);
        }

        .preview-content {
            padding: 20px;
            min-height: 200px;
        }

        .notification-center {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            background: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .notifications-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .notification {
            padding: 10px 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification.unread {
            background: rgba(74, 144, 226, 0.1);
        }

        .notification-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--secondary-color);
            color: white;
        }

        .notification-content {
            flex: 1;
        }

        .notification-time {
            font-size: 0.8em;
            color: var(--text-color);
            opacity: 0.7;
        }

        /* Add modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            position: relative;
            background: var(--background-color);
            margin: 15% auto;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .close-modal {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
        }

        .modal-header {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .modal-form input {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background: var(--background-color);
            color: var(--text-color);
        }

        .modal-form button {
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .modal-form button:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="header">
            <h1>Dashboard</h1>
            <div class="theme-toggle">
                <i class="fas fa-moon"></i>
            </div>
        </header>

        <div class="dashboard-grid">
            <aside class="sidebar">
                <ul class="sidebar-menu">
                    <li><a href="#" class="active"><i class="fas fa-home"></i> Dashboard</a></li>
                    <li><a href="#" onclick="showScheduler()"><i class="fas fa-calendar"></i> Schedule</a></li>
                    <li><a href="#" onclick="showAnalytics()"><i class="fas fa-chart-bar"></i> Analytics</a></li>
                    <li><a href="#" onclick="showSettings()"><i class="fas fa-cog"></i> Settings</a></li>
                </ul>
            </aside>

            <main class="main-content">
                <div class="user-profile">
                    <label class="profile-upload">
                        <input type="file" accept="image/*" onchange="updateProfileImage(event)">
                        <div class="profile-image">
                            <i class="fas fa-user"></i>
                        </div>
                    </label>
                    <div class="profile-info">
                        <h2 id="userName">Loading...</h2>
                        <p id="userEmail">Loading...</p>
                        <button class="btn logout-btn" onclick="logout()">Log Out</button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalPosts">0</h3>
                        <p>Total Posts</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalEngagement">0</h3>
                        <p>Total Engagement</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="scheduledPosts">0</h3>
                        <p>Scheduled Posts</p>
                    </div>
                </div>

                <div class="post-form">
                    <textarea placeholder="What's on your mind?" rows="4"></textarea>
                    <div class="post-actions">
                        <div class="platform-select">
                            <div class="platform-option">
                                <input type="checkbox" id="facebook" name="platform" value="facebook">
                                <label for="facebook"><i class="fab fa-facebook"></i> Facebook</label>
                            </div>
                            <div class="platform-option">
                                <input type="checkbox" id="twitter" name="platform" value="twitter">
                                <label for="twitter"><i class="fab fa-twitter"></i> Twitter</label>
                            </div>
                            <div class="platform-option">
                                <input type="checkbox" id="instagram" name="platform" value="instagram">
                                <label for="instagram"><i class="fab fa-instagram"></i> Instagram</label>
                            </div>
                            <div class="platform-option">
                                <input type="checkbox" id="linkedin" name="platform" value="linkedin">
                                <label for="linkedin"><i class="fab fa-linkedin"></i> LinkedIn</label>
                            </div>
                            <div class="platform-option">
                                <input type="checkbox" id="tiktok" name="platform" value="tiktok">
                                <label for="tiktok"><i class="fab fa-tiktok"></i> TikTok</label>
                            </div>
                            <div class="platform-option">
                                <input type="checkbox" id="pinterest" name="platform" value="pinterest">
                                <label for="pinterest"><i class="fab fa-pinterest"></i> Pinterest</label>
                            </div>
                            <div class="platform-option">
                                <input type="checkbox" id="youtube" name="platform" value="youtube">
                                <label for="youtube"><i class="fab fa-youtube"></i> YouTube</label>
                            </div>
                        </div>
                        <div class="post-scheduling">
                            <div class="schedule-option">
                                <input type="radio" id="postNow" name="scheduleType" value="now" checked>
                                <label for="postNow">Post Now</label>
                            </div>
                            <div class="schedule-option">
                                <input type="radio" id="schedulePost" name="scheduleType" value="schedule">
                                <label for="schedulePost">Schedule Post</label>
                            </div>
                            <div class="schedule-option">
                                <input type="radio" id="recurringPost" name="scheduleType" value="recurring">
                                <label for="recurringPost">Recurring Post</label>
                            </div>
                        </div>
                        <div id="scheduleDetails" class="schedule-details" style="display: none;">
                            <div class="datetime-picker">
                                <input type="datetime-local" id="scheduleTime">
                            </div>
                        </div>
                        <div id="recurringDetails" class="recurring-details" style="display: none;">
                            <div class="recurring-options">
                                <select id="recurringFrequency">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                                <div id="weeklyOptions" style="display: none;">
                                    <div class="day-selector">
                                        <input type="checkbox" id="mon" name="day" value="1">
                                        <label for="mon">Mon</label>
                                        <input type="checkbox" id="tue" name="day" value="2">
                                        <label for="tue">Tue</label>
                                        <input type="checkbox" id="wed" name="day" value="3">
                                        <label for="wed">Wed</label>
                                        <input type="checkbox" id="thu" name="day" value="4">
                                        <label for="thu">Thu</label>
                                        <input type="checkbox" id="fri" name="day" value="5">
                                        <label for="fri">Fri</label>
                                        <input type="checkbox" id="sat" name="day" value="6">
                                        <label for="sat">Sat</label>
                                        <input type="checkbox" id="sun" name="day" value="0">
                                        <label for="sun">Sun</label>
                                    </div>
                                </div>
                                <input type="time" id="recurringTime">
                                <input type="date" id="endDate" placeholder="End Date">
                            </div>
                        </div>
                        <button class="btn" onclick="createPost()">Post</button>
                    </div>
                </div>

                <div class="post-preview">
                    <h3>Post Preview</h3>
                    <div class="preview-container">
                        <div class="preview-tabs">
                            <button class="preview-tab active" data-platform="facebook">Facebook</button>
                            <button class="preview-tab" data-platform="twitter">Twitter</button>
                            <button class="preview-tab" data-platform="instagram">Instagram</button>
                            <button class="preview-tab" data-platform="linkedin">LinkedIn</button>
                            <button class="preview-tab" data-platform="tiktok">TikTok</button>
                            <button class="preview-tab" data-platform="pinterest">Pinterest</button>
                            <button class="preview-tab" data-platform="youtube">YouTube</button>
                        </div>
                        <div class="preview-content">
                            <!-- Preview content will be dynamically updated -->
                        </div>
                    </div>
                </div>

                <div id="notificationCenter" class="notification-center">
                    <div class="notification-header">
                        <h3>Notifications</h3>
                        <button class="clear-all">Clear All</button>
                    </div>
                    <div class="notifications-list">
                        <!-- Notifications will be dynamically added here -->
                    </div>
                </div>

                <div class="posts-list" id="postsList">
                    <!-- Posts will be dynamically added here -->
                </div>

                <div class="social-links">
                    <h2>Social Media Accounts</h2>
                    <div class="social-link" onclick="openLinkModal('facebook')">
                        <i class="fab fa-facebook" style="color: #1877f2;"></i>
                        <span>Facebook</span>
                        <span class="status" id="facebook-status">Not Connected</span>
                    </div>
                    <div class="social-link" onclick="openLinkModal('twitter')">
                        <i class="fab fa-twitter" style="color: #1da1f2;"></i>
                        <span>Twitter</span>
                        <span class="status" id="twitter-status">Not Connected</span>
                    </div>
                    <div class="social-link" onclick="openLinkModal('instagram')">
                        <i class="fab fa-instagram" style="color: #e4405f;"></i>
                        <span>Instagram</span>
                        <span class="status" id="instagram-status">Not Connected</span>
                    </div>
                    <div class="social-link" onclick="openLinkModal('linkedin')">
                        <i class="fab fa-linkedin" style="color: #0077b5;"></i>
                        <span>LinkedIn</span>
                        <span class="status" id="linkedin-status">Not Connected</span>
                    </div>
                    <div class="social-link" onclick="openLinkModal('tiktok')">
                        <i class="fab fa-tiktok" style="color: #000000;"></i>
                        <span>TikTok</span>
                        <span class="status" id="tiktok-status">Not Connected</span>
                    </div>
                    <div class="social-link" onclick="openLinkModal('youtube')">
                        <i class="fab fa-youtube" style="color: #ff0000;"></i>
                        <span>YouTube</span>
                        <span class="status" id="youtube-status">Not Connected</span>
                    </div>
                </div>

                <!-- Social Media Link Modal -->
                <div id="linkModal" class="modal">
                    <div class="modal-content">
                        <span class="close-modal" onclick="closeLinkModal()">&times;</span>
                        <div class="modal-header">
                            <h2 id="modalTitle">Link Account</h2>
                        </div>
                        <form class="modal-form" id="linkForm" onsubmit="handleAccountLink(event)">
                            <input type="hidden" id="platformInput" name="platform">
                            <div>
                                <label for="handleInput">Enter your handle/username:</label>
                                <input type="text" id="handleInput" name="handle" required>
                            </div>
                            <div id="additionalFields">
                                <!-- Dynamic fields will be added here based on platform -->
                            </div>
                            <button type="submit" class="btn">Link Account</button>
                        </form>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('settingsModal')">&times;</span>
            <h2>Settings</h2>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="settingsName">
            </div>
            <div class="form-group">
                <label>Bio</label>
                <textarea id="settingsBio"></textarea>
            </div>
            <button class="btn" onclick="saveSettings()">Save Changes</button>
        </div>
    </div>

    <script type="module">
        import { 
            auth,
            db,
            storage,
            signOut,
            signInWithPopup,
            googleProvider,
            facebookProvider,
            twitterProvider,
            githubProvider,
            updateUserProfile,
            getUserProfile,
            createPost,
            uploadProfileImage,
            onSnapshot,
            addDoc,
            updateDoc,
            deleteDoc,
            serverTimestamp,
            collection,
            query,
            where,
            orderBy,
            limit,
            getDocs,
            doc,
            getDoc,
            ref,
            uploadBytes,
            getDownloadURL
        } from './firebase-config.js';

        // Global variables for statistics
        let totalPosts = 0;
        let totalEngagement = 0;
        let scheduledPosts = 0;

        // Initialize dashboard
        async function initializeDashboard() {
            const user = auth.currentUser;
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            // Load user profile
            await loadUserProfile(user);
            
            // Initialize features
            initializeThemeToggle();
            initializePostForm();
            initializeNotifications();
            await loadConnectedAccounts();
            await loadStatistics();
            await loadRecentPosts();
            
            // Set up real-time listeners
            setupRealTimeListeners(user.uid);
        }

        // Load and display user profile
        async function loadUserProfile(user) {
            const userProfile = await getUserProfile(user.uid);
            document.getElementById('userName').textContent = userProfile?.displayName || user.displayName || 'User';
            document.getElementById('userEmail').textContent = user.email;

            if (userProfile?.photoURL || user.photoURL) {
                document.querySelector('.profile-image').innerHTML = `
                    <img src="${userProfile?.photoURL || user.photoURL}" alt="Profile" 
                         style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                `;
            }
        }

        // Profile image upload handler
        window.updateProfileImage = async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            try {
                const user = auth.currentUser;
                showNotification('Uploading profile image...', 'info');

                // Upload to Firebase Storage
                const storageRef = ref(storage, `profile_images/${user.uid}/${file.name}`);
                await uploadBytes(storageRef, file);
                const photoURL = await getDownloadURL(storageRef);

                // Update profile
                await updateUserProfile(user.uid, { photoURL });
                document.querySelector('.profile-image').innerHTML = `
                    <img src="${photoURL}" alt="Profile" 
                         style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                `;

                showNotification('Profile image updated successfully!', 'success');
            } catch (error) {
                console.error('Error updating profile image:', error);
                showNotification('Error updating profile image', 'error');
            }
        };

        // Initialize theme toggle
        function initializeThemeToggle() {
            const themeToggle = document.querySelector('.theme-toggle');
            const body = document.body;
            const theme = localStorage.getItem('theme') || 'light';
            
            body.classList.toggle('dark-theme', theme === 'dark');
            themeToggle.innerHTML = theme === 'dark' ? 
                '<i class="fas fa-sun"></i>' : 
                '<i class="fas fa-moon"></i>';

            themeToggle.addEventListener('click', () => {
                body.classList.toggle('dark-theme');
                const isDark = body.classList.contains('dark-theme');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                themeToggle.innerHTML = isDark ? 
                    '<i class="fas fa-sun"></i>' : 
                    '<i class="fas fa-moon"></i>';
            });
        }

        // Initialize post form
        function initializePostForm() {
            const textarea = document.querySelector('.post-form textarea');
            const scheduleTypeInputs = document.querySelectorAll('input[name="scheduleType"]');
            const scheduleDetails = document.getElementById('scheduleDetails');
            const recurringDetails = document.getElementById('recurringDetails');
            const recurringFrequency = document.getElementById('recurringFrequency');
            const weeklyOptions = document.getElementById('weeklyOptions');

            // Character counter
            textarea.addEventListener('input', () => {
                updatePostPreview();
                const remainingChars = 280 - textarea.value.length;
                document.getElementById('charCount').textContent = `${remainingChars} characters remaining`;
            });

            // Schedule type handling
            scheduleTypeInputs.forEach(input => {
                input.addEventListener('change', (e) => {
                    scheduleDetails.style.display = e.target.value === 'schedule' ? 'block' : 'none';
                    recurringDetails.style.display = e.target.value === 'recurring' ? 'block' : 'none';
                });
            });

            // Recurring frequency handling
            recurringFrequency.addEventListener('change', (e) => {
                weeklyOptions.style.display = e.target.value === 'weekly' ? 'block' : 'none';
            });

            // Platform selection handling
            document.querySelectorAll('.platform-option input').forEach(checkbox => {
                checkbox.addEventListener('change', updatePostPreview);
            });
        }

        // Create post handler
        window.createPost = async () => {
            const content = document.querySelector('.post-form textarea').value;
            if (!content) {
                showNotification('Please enter some content for your post', 'error');
                return;
            }

            const platforms = Array.from(document.querySelectorAll('input[name="platform"]:checked'))
                .map(input => input.value);
            if (platforms.length === 0) {
                showNotification('Please select at least one platform', 'error');
                return;
            }

            const scheduleType = document.querySelector('input[name="scheduleType"]:checked').value;
            const user = auth.currentUser;

            try {
                const postData = {
                    content,
                    platforms,
                    userId: user.uid,
                    createdAt: serverTimestamp(),
                    status: 'draft'
                };

                // Handle scheduling
                if (scheduleType === 'schedule') {
                    const scheduleTime = document.getElementById('scheduleTime').value;
                    if (!scheduleTime) {
                        showNotification('Please select a schedule time', 'error');
                        return;
                    }
                    postData.scheduleTime = new Date(scheduleTime).toISOString();
                    postData.status = 'scheduled';
                } else if (scheduleType === 'recurring') {
                    const frequency = document.getElementById('recurringFrequency').value;
                    const time = document.getElementById('recurringTime').value;
                    const endDate = document.getElementById('endDate').value;
                    
                    if (!time || !endDate) {
                        showNotification('Please fill in all recurring post details', 'error');
                        return;
                    }

                    postData.recurring = {
                        frequency,
                        time,
                        endDate,
                        days: frequency === 'weekly' ? 
                            Array.from(document.querySelectorAll('input[name="day"]:checked'))
                                .map(input => parseInt(input.value)) : []
                    };
                    postData.status = 'recurring';
                }

                // Create post in Firestore
                await addDoc(collection(db, 'posts'), postData);

                // Clear form
                document.querySelector('.post-form textarea').value = '';
                document.querySelectorAll('input[name="platform"]:checked')
                    .forEach(checkbox => checkbox.checked = false);
                
                showNotification('Post created successfully!', 'success');
                await loadStatistics(); // Refresh statistics
            } catch (error) {
                console.error('Error creating post:', error);
                showNotification('Error creating post: ' + error.message, 'error');
            }
        };

        // Load statistics
        async function loadStatistics() {
            try {
                const user = auth.currentUser;
                const postsRef = collection(db, 'posts');
                const userPostsQuery = query(postsRef, where('userId', '==', user.uid));
                const querySnapshot = await getDocs(userPostsQuery);

                let total = 0;
                let scheduled = 0;
                let engagement = 0;

                querySnapshot.forEach(doc => {
                    const post = doc.data();
                    total++;
                    if (post.status === 'scheduled' || post.status === 'recurring') {
                        scheduled++;
                    }
                    engagement += (post.likes || 0) + (post.comments || 0) + (post.shares || 0);
                });

                document.getElementById('totalPosts').textContent = total;
                document.getElementById('scheduledPosts').textContent = scheduled;
                document.getElementById('totalEngagement').textContent = engagement;

                totalPosts = total;
                scheduledPosts = scheduled;
                totalEngagement = engagement;
            } catch (error) {
                console.error('Error loading statistics:', error);
                showNotification('Error loading statistics', 'error');
            }
        }

        // Load recent posts
        async function loadRecentPosts() {
            try {
                const user = auth.currentUser;
                const postsRef = collection(db, 'posts');
                const recentPostsQuery = query(
                    postsRef,
                    where('userId', '==', user.uid),
                    orderBy('createdAt', 'desc'),
                    limit(5)
                );

                const querySnapshot = await getDocs(recentPostsQuery);
                const postsList = document.getElementById('postsList');
                postsList.innerHTML = '<h2>Recent Posts</h2>';

                querySnapshot.forEach(doc => {
                    const post = doc.data();
                    const postElement = document.createElement('div');
                    postElement.className = 'post-item';
                    postElement.innerHTML = `
                        <div class="post-content">${post.content}</div>
                        <div class="post-meta">
                            <div class="post-platforms">
                                ${post.platforms.map(platform => 
                                    `<i class="fab fa-${platform}" title="${platform}"></i>`
                                ).join('')}
                            </div>
                            <div class="post-status ${post.status}">${post.status}</div>
                            <div class="post-time">${formatTimestamp(post.createdAt)}</div>
                        </div>
                        <div class="post-actions">
                            <button onclick="editPost('${doc.id}')" class="btn">Edit</button>
                            <button onclick="deletePost('${doc.id}')" class="btn btn-danger">Delete</button>
                        </div>
                    `;
                    postsList.appendChild(postElement);
                });
            } catch (error) {
                console.error('Error loading posts:', error);
                showNotification('Error loading recent posts', 'error');
            }
        }

        // Set up real-time listeners
        function setupRealTimeListeners(userId) {
            // Listen for new notifications
            const notificationsQuery = query(
                collection(db, 'notifications'),
                where('userId', '==', userId),
                orderBy('timestamp', 'desc'),
                limit(20)
            );

            onSnapshot(notificationsQuery, (snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === 'added') {
                        addNotification(change.doc.data());
                    }
                });
            });

            // Listen for post updates
            const postsQuery = query(
                collection(db, 'posts'),
                where('userId', '==', userId)
            );

            onSnapshot(postsQuery, (snapshot) => {
                loadStatistics();
                loadRecentPosts();
            });
        }

        // Post preview functionality
        function updatePostPreview() {
            const content = document.querySelector('.post-form textarea').value;
            const selectedPlatforms = Array.from(document.querySelectorAll('input[name="platform"]:checked'))
                .map(input => input.value);
            
            const previewTabs = document.querySelector('.preview-tabs');
            const previewContent = document.querySelector('.preview-content');
            
            // Update preview tabs
            previewTabs.innerHTML = selectedPlatforms.map(platform => `
                <button class="preview-tab ${platform === selectedPlatforms[0] ? 'active' : ''}" 
                        data-platform="${platform}">
                    ${platform.charAt(0).toUpperCase() + platform.slice(1)}
                </button>
            `).join('');
            
            // Show preview for first selected platform
            if (selectedPlatforms.length > 0) {
                showPlatformPreview(selectedPlatforms[0], content);
            } else {
                previewContent.innerHTML = '<p>Select a platform to see preview</p>';
            }
            
            // Add click handlers to tabs
            document.querySelectorAll('.preview-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelector('.preview-tab.active').classList.remove('active');
                    tab.classList.add('active');
                    showPlatformPreview(tab.dataset.platform, content);
                });
            });
        }

        function showPlatformPreview(platform, content) {
            const previewContent = document.querySelector('.preview-content');
            const user = auth.currentUser;
            
            switch(platform) {
                case 'twitter':
                    previewContent.innerHTML = `
                        <div class="twitter-preview">
                            <div class="tweet-header">
                                <img src="${user.photoURL || 'default-avatar.png'}" alt="Profile">
                                <span>${user.displayName}</span>
                                <span class="username">@${user.displayName?.toLowerCase().replace(/\s+/g, '')}</span>
                            </div>
                            <div class="tweet-content">${content}</div>
                            <div class="tweet-actions">
                                <i class="far fa-heart"></i>
                                <i class="far fa-retweet"></i>
                                <i class="far fa-comment"></i>
                            </div>
                        </div>
                    `;
                    break;
                case 'facebook':
                    previewContent.innerHTML = `
                        <div class="facebook-preview">
                            <div class="fb-header">
                                <img src="${user.photoURL || 'default-avatar.png'}" alt="Profile">
                                <div class="fb-user-info">
                                    <span class="name">${user.displayName}</span>
                                    <span class="time">Just now</span>
                                </div>
                            </div>
                            <div class="fb-content">${content}</div>
                            <div class="fb-actions">
                                <button><i class="far fa-thumbs-up"></i> Like</button>
                                <button><i class="far fa-comment"></i> Comment</button>
                                <button><i class="far fa-share"></i> Share</button>
                            </div>
                        </div>
                    `;
                    break;
                // Add more platform previews...
            }
        }

        // Settings functionality
        window.showSettings = () => {
            document.getElementById('settingsModal').style.display = 'block';
        };

        window.closeModal = (modalId) => {
            document.getElementById(modalId).style.display = 'none';
        };

        window.saveSettings = async () => {
            const user = auth.currentUser;
            const name = document.getElementById('settingsName').value;
            const bio = document.getElementById('settingsBio').value;

            try {
                await updateUserProfile(user.uid, { displayName: name, bio });
                document.getElementById('userName').textContent = name;
                closeModal('settingsModal');
                showNotification('Settings saved successfully!', 'success');
            } catch (error) {
                console.error('Error saving settings:', error);
                showNotification('Error saving settings', 'error');
            }
        };

        // Post management
        window.editPost = async (postId) => {
            // Implementation for editing posts
        };

        window.deletePost = async (postId) => {
            if (!confirm('Are you sure you want to delete this post?')) return;

            try {
                await deleteDoc(doc(db, 'posts', postId));
                showNotification('Post deleted successfully!', 'success');
            } catch (error) {
                console.error('Error deleting post:', error);
                showNotification('Error deleting post', 'error');
            }
        };

        // Notification system
        function showNotification(message, type = 'info') {
            const notificationsList = document.querySelector('.notifications-list');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fas ${getNotificationIcon(type)}"></i>
                </div>
                <div class="notification-content">
                    <div class="notification-text">${message}</div>
                    <div class="notification-time">${new Date().toLocaleTimeString()}</div>
                </div>
            `;
            notificationsList.prepend(notification);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function getNotificationIcon(type) {
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                info: 'fa-info-circle',
                warning: 'fa-exclamation-triangle'
            };
            return icons[type] || 'fa-bell';
        }

        // Utility functions
        function formatTimestamp(timestamp) {
            if (!timestamp) return '';
            const date = timestamp.toDate();
            return date.toLocaleString();
        }

        // Initialize dashboard when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeDashboard);

        // Logout functionality
        window.logout = async () => {
            try {
                await signOut(auth);
                window.location.href = 'login.html';
            } catch (error) {
                console.error('Error signing out:', error);
                showNotification('Error signing out', 'error');
            }
        };
    </script>
</body>
</html> 